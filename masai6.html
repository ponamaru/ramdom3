<!DOCTYPE html>
<html>
<head>
<style>
html, body {
  background-color: black;
  overflow: hidden;
  margin: 0;
}
#vi {
  position: absolute;
  top: 0;
  left: 0;
  display: block;

}
#bo1 {
  position: absolute;
  top: 80%;
  left: 1%;
}
#bo2 {
  transform: rotate(90deg); 
  position: absolute;
  top: 80%;
  left: 10%;
  display: none;
}
#bo4 {
  position: absolute;
  top: 80%;
  left: 10%;
  display: inline-block;
  animation: floatUpDown 2s ease-in-out infinite;
}
#bo3 {
  transform: rotate(180deg); 
  position: absolute;
  top: 80%;
  left: 20%;
}

#vi2 {  
position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: auto;
  display: none;
  pointer-events: none; 
}
#vi3 {  
position: absolute;
  top: 0;
  left: 20%;
  width: 100%;
  height: auto;
  display: block;
  pointer-events: auto; 

}
@keyframes floatUpDown {
  0%   { transform: rotate(90deg) translateX(0); }
  50%  { transform: rotate(90deg) translateX(-10px); }
  100% { transform: rotate(90deg) translateX(0); }
}
#area {
  display: block;
  color: #FFF;
  position: absolute;
  top: 80%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 30px;
  pointer-events: none; 
  background-color: rgba(0,0,0,0.5);
  z-index: 1000;
}
#btext {
  display: block;
  color: #FFF;
  position: absolute;
  top: 80%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 30px;
  pointer-events: none; 
  background-color: rgba(0,0,0,0.5);
  z-index: 1001;
}
#obb1,#obb2,#obb3,#obb4,#obb5,#obb6 {
  position: absolute;
  top: 0;
  left: 0;
  width: 20%; 
  height: auto;
  display: none;

}
.catch {
  transform: translate(-50%, -50%);
}

</style>
</head>
<body>

<img src="14.png" id="vi" width="140%">
<div id="vi2"><div id="vi3">
<img src="16.png" id="obb1" width="500" class="catch">
<img src="16.png" id="obb2" width="500" class="catch">
<img src="16.png" id="obb3" width="500" class="catch">
<img src="16.png" id="obb4" width="500" class="catch">
<img src="16.png" id="obb5" width="500" class="catch">
<img src="16.png" id="obb6" width="500" class="catch">

</div></div>
<img src="イラスト13.png" id="bo1" width="10%">
<img src="イラスト13.png" id="bo2" width="10%">
<img src="イラスト13.png" id="bo3" width="10%">
<div id="area"></div>
<img src="イラスト13.png" id="bo4" width="10%">
<script>

const vi = document.getElementById("vi");
const vi2 = document.getElementById("vi2");
//ここは悔しいけどchatGPTに書かせた
window.onload = function() {
  const adjustPosition = () => {
    const winW = window.innerWidth;
    const winH = window.innerHeight;
    const imgW = vi.offsetWidth;
    const imgH = vi.offsetHeight;
    const leftPos = (winW / 2 - imgW / 2);
    const topPos = (winH / 2 - imgH / 2);
    vi.style.left = leftPos + "px";
    vi.style.top = topPos + "px";
    vi2.style.left = leftPos + "px";
    vi2.style.top = "50%";
  };

  if (vi.complete) {
    adjustPosition();
  } else {
    vi.onload = adjustPosition;
  }
};
//ここまで

var backSS = [["1.png","2.png"],["15.png","14.png"]];
var backN = 0;
var backNN = 0;
//["width","top","left","image.src","none","display","scene","serif","z","event","speed","backN","backNN"]

var spF = [["20%","30%","30%","16.png","block",null,0,30,"no",20,1,0,1],["20%","10%","10%","イラスト15.png","block",null,1,30,"no",20,0,0,2]];
var spFs = [spF,
[["20%","50%","50%","16.png","block",null,0,450,"no",30,0,0,6],
["20%","0%","0%","イラスト15.png","none",null,0,30,"no",25,1,0,4]],

[["20%","0%","0%","16.png","none",null,0,30,"no",21,1,0,5],
["20%","60%","55%","16.png","block",null,0,10,"no",40,0,0,3]],

[["20%","65%","55%","14.png","none",null,0,400,"no",20,0,0,7]],

[["20%","80%","55%","16.png","none",null,0,400,"no",20,1,0,8]]];

vi.src = backSS[backN][backNN];
vi.style.width = "140%";
let eventB = "";
var con = true;

//～ChatGPT～

// イージング関数
function easeIn(t) {
  return t * t * t;
}
function easeOut(t) {
  return 1 - Math.pow(1 - t, 3);
}

// 加速アニメーション（左に移動）
function animateIn(startX, endX, duration, onComplete) {
  const startTime = performance.now();

  function animate(now) {
    const elapsed = now - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const eased = easeIn(progress);
    vi.style.left = startX + (endX - startX) * eased + "px";
vi2.style.left = startX + (endX - startX) * eased + "px";
    if (progress < 1) {
      requestAnimationFrame(animate);
    } else if (onComplete) {
      onComplete();
    }
  }

  requestAnimationFrame(animate);
}

// 減速アニメーション（さらに移動）
function animateOut(startX, endX, duration) {
  const startTime = performance.now();
  function animate(now) {
    const elapsed = now - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const eased = easeOut(progress);
    
if(eventB === "bo1"){
vi.style.left = startX -500 + (endX - startX) * eased + "px";
vi2.style.left = startX -500 + (endX - startX) * eased + "px";
}
if(eventB === "bo3"){
vi.style.left = startX +500 + (endX - startX) * eased + "px";
vi2.style.left = startX +500 + (endX - startX) * eased + "px";
}
    if (progress < 1) {
      requestAnimationFrame(animate);
    }
  }

  requestAnimationFrame(animate);
}
//～ここまで～

document.getElementById("bo1").addEventListener("click", () => {
if(con === true) {
con = false;
setTimeout(() => {
con = true;
bo4B();
backA = true;
}, "500");
  eventB = "bo1";
  red();
left();

  const startX = parseFloat(vi.style.left) || 0;
  const midX = startX + 200;
  const endX = startX + 500;

  animateIn(startX, midX, 250, () => {
    animateOut(midX, endX, 250);
  });
}
});

document.getElementById("bo3").addEventListener("click", () => {
if(con === true) {
con = false;
setTimeout(() => {
con = true;
bo4B();

}, "500");
  eventB = "bo3";
  red();
right();
  const startX = parseFloat(vi.style.left) || 0;
  const midX = startX - 200;
  const endX = startX - 500;

  animateIn(startX, midX, 250, () => {
    animateOut(midX, endX, 250);

  });
}
});


var serifS = [["Hello.","Wellcome to the school."],["a"]];
var serifSS = [serifS,[["see you"],["b"]],[["see you"],["b"]],[["see you"],["b"]],[["see you"],["b"]],[["see you"],["b"]]]
var serifN = 0;
var serifNN = 0;
var serifNS = [["Hello.","Wellcome to the school."],["a"],["see you"],["b"]];
var talk = false;
var obs = [document.getElementById("obb1"),document.getElementById("obb2"),document.getElementById("obb3"),document.getElementById("obb4"),document.getElementById("obb5"),document.getElementById("obb6")];
var obn = 0;
var imgE = document.getElementsByTagName('img');

document.getElementById("vi3").addEventListener("click", () => {
obn = obs.indexOf(event.target);

if(con === true) {
serifNN = 0;
talk = true;
for (let i = 0; i < spFs[obn].length; i++) {
if(backSS[backN][backNN] === backSS[spFs[obn][i][10]][spFs[obn][i][11]]){
serifN = spFs[obn][i][6];
}
}
con = false;
}
talkF();

});

function talkF (){
if((serifNN < serifNS[serifN].length)&&(talk === true)) {
document.getElementById("area").innerText = serifNS[serifN][serifNN];
serifNN += 1;
talk = false;
  setTimeout(() => {
talk = true;
  }, 250);
}

if((serifNN >= serifNS[serifN].length )&&(talk === true)){
document.getElementById("area").innerText = null;
con = true;
serifNN = 0;
talk = false;
}
}
var backA = true;
addEventListener("click", talkF);

function red() {
document.getElementById("bo4").style.display = "none";
  document.getElementById(eventB).src = "イラスト14.png";
backA = false;
  setTimeout(() => {
    document.getElementById(eventB).src = "イラスト13.png";
backA = true;
  }, 250);
}

function left (){
backNN -= 1;
if(backNN < 0)backNN = backSS[backN].length -1;
if(backNN > backSS[backN].length -1)backNN = 0;
  setTimeout(() => {
vi.src = backSS[backN][backNN];
vi2.style.display = "none";

  }, 250);
}
function right (){
backNN += 1;
if(backNN < 1)backNN = backSS[backN].length -1;
if(backNN > backSS[backN].length -1)backNN = 0;
  setTimeout(() => {
vi.src = backSS[backN][backNN];
vi2.style.display = "none";

  }, 250);

}

document.getElementById("bo4").addEventListener("click", () => {
if(con === true) {
backC();
vi2.style.display = "none";

document.getElementById("bo4").style.display = "none";
con = false;
setTimeout(() => {
con = true;
bo4B();
backA = true;
}, "500");
}
});

function backC() {
for (let s = 0; s < spFs.length; s++) {
for (let i = 0; i < spFs[s].length; i++) {
for (let i2 = 0; i2 < bo4xy.length; i2++) {
if(spFs[s][i][8] === "catch")spFs[s][i][7] -= bo4xy[i2][4];

}
}
}
for (let i = 0; i < bo4xy.length; i++) {
if(backSS[backN][backNN] === backSS[bo4xy[i][6]][bo4xy[i][7]]){
if(bo4xy[i][3] !== null)backN = bo4xy[i][3];
}
}
vi.src = backSS[backN][backNN];
}


var bo4xy = [["70%","40%",null,0,1000,null,1,1],["70%","30%",null,1,1000,0,0,0]];

function bo4B () {
for (let i = 0; i < bo4xy.length; i++) {
if(backSS[backN][backNN] === backSS[bo4xy[i][6]][bo4xy[i][7]]){
document.getElementById("bo4").style.display = "block";
document.getElementById("bo4").style.top = bo4xy[i][0];
document.getElementById("bo4").style.left = bo4xy[i][1];
}
}

}
function vi2B(){

for (let s = 0; s < spFs.length; s++) {
let found = false;
for (let i = 0; i < spFs[s].length; i++) {


obs[s].style.zIndex = spFs[s][i][12];



if(backA === true){
if(backSS[backN][backNN] === backSS[spFs[s][i][10]][spFs[s][i][11]]){
vi2.style.display = "block";

let widthPercent = 0;
widthPercent = spFs[s][i][7] * 0.1;
obs[s].style.width = parseFloat(spFs[s][i][0]) + widthPercent + "%";
obs[s].style.top = spFs[s][i][1];
obs[s].style.left = spFs[s][i][2];
obs[s].style.display = spFs[s][i][4];
obs[s].src = spFs[s][i][3];
found = true;
 break;  
}
}

if(!found){
if(backA === true){
obs[s].style.display = "none";
}
}
}
}
}

function Zin() {
  document.getElementById("bo4").style.zIndex = 1000;
  document.getElementById("bo1").style.zIndex = 1001;
  document.getElementById("bo3").style.zIndex = 1002;
document.getElementById("area").style.zIndex = 1003;
 for (let i = 0; i < obs.length; i++) {
    for (let s = 0; s < spFs.length; s++) {

    for (let s2 = 0; s2 < spFs[s].length; s2++) {


    }
  }
}

}


let intervalI = setInterval(Zin, 50);


function catch2(){

let A;
//chatGPT
const currentScene = backSS[backN][backNN];
  let allObjs = [];
  for (let i = 0; i < spFs.length; i++) {
    for (let s = 0; s < spFs[i].length; s++) {
      const obj = spFs[i][s];

        allObjs.push(obj);

    }
  }
//ここまで
    const winW = window.innerWidth;
    const winH = window.innerHeight;
  for (let i = 0; i < allObjs.length; i++) {
    A = allObjs[i];
if(A[8] === "catch"&&A[4] ==="block"){

    for (let j = 0; j < allObjs.length; j++) {
if(A[7] < 1000){
//chatGPT
      if (i === j) continue;
      const B = allObjs[j];
//ここまで
      const width50 = winW/2;
      const height50 = winW/2;
      const widthA = parseFloat(A[0]);
      const widthB = parseFloat(B[0]);
      const leftA = parseFloat(A[2]);
      const leftB = parseFloat(B[2]);
      const rightA = parseFloat(A[0])/2;
      const rightB = parseFloat(B[0])/2;
      const leftA2 = parseFloat(A[2])*100/winW;
      const leftB2 = parseFloat(B[2])*100/winW;
      const widthA2 = parseFloat(A[0])*100/winW;
      const widthB2 = parseFloat(B[0])*100/winW;



let ZinH = [B[7]];
document.getElementById("btext").innerText = leftA+","+widthA+","+leftB+","+widthB;
if((leftA2 + widthA2 + A[7]>= leftB2) && (leftA2  <= leftB2 + B[7] + widthB2)
&&(A[7] < B[7]&&A[7] >= B[7]-A[9]*2 )&&(backSS[A[10]][A[11]] ===backSS[B[10]][B[11]])&&(B[4] ==="block")){
ZinH[0] = B[7];
A[12] = ZinH[0] + 1;

let left2 = leftA - A[9]*0.1;
let left = leftA + A[9]*0.1;

if(leftA < leftB) {
A[2] = left2 + "%";
}else{
 A[2] = left + "%";
}
         
}else{

A[7] += A[9] * 0.1; 


if(A[7] < Zin[0])A[12] = ZinH[0] + 1;

}
}
if (A[7] >= 1000 && backN !== A[10]) {
let hou=[backN];
for (let u = 0; u < hou.length; u++) {

for (let w = 0; w < bo4xy.length; w++) {
let Pr = backN;
if(bo4xy[w][3] === hou[u]){
hou[w] = bo4xy[w][6];

document.getElementById("btext").innerText = hou;

if( A[10]===bo4xy[w][6]){
 A[10] = bo4xy[w][3];
if(bo4xy[w][5] !== null) A[11] = bo4xy[w][5];
A[7] -= bo4xy[w][4];
break;
}
}

}
}
}

} 
}
}
}



let intervalI2 = setInterval(vi2B, 50);

let intervalI3 = null;

function catch3(){
if (event.keyCode === 90&&!intervalI3){
intervalI3 = setInterval(catch2, 50);
}
if (event.keyCode === 88){
spFs[2][1][2] = "45%"; 
}
}

document.addEventListener("keydown", catch3);

bo4B();


</script>

<div id="btext"></div>
</body>
</html>